# Migration `20200412185025-validation-first-pass`

This migration has been generated by Robert Westbury at 4/12/2020, 6:50:25 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."ValidationAction" (
    "action" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "detail" text   ,
    "id" SERIAL,
    "validationId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Validation" (
    "allowUnknown" boolean  NOT NULL DEFAULT true,
    "formId" text  NOT NULL ,
    "id" SERIAL,
    PRIMARY KEY ("id")
) 

CREATE UNIQUE INDEX "Validation_formId" ON "public"."Validation"("formId")

ALTER TABLE "public"."ValidationAction" ADD FOREIGN KEY ("validationId")REFERENCES "public"."Validation"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Validation" ADD FOREIGN KEY ("formId")REFERENCES "public"."Form"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200412160954-fix-note..20200412185025-validation-first-pass
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider      = "prisma-client-js"
@@ -32,9 +32,27 @@
   note      String   @default("")
 }
 model Form {
-  id      String @id
-  ownerId String
-  owner   User   @relation(fields: [ownerId], references: [id])
-  name    String
+  id         String      @id
+  ownerId    String
+  owner      User        @relation(fields: [ownerId], references: [id])
+  name       String
+  validation Validation?
+}
+
+model ValidationAction {
+  id           Int        @default(autoincrement()) @id
+  action       String
+  detail       String?
+  validationId Int
+  validation   Validation @relation(fields: [validationId], references: [id])
+  createdAt    DateTime   @default(now())
+}
+
+model Validation {
+  id           Int                @default(autoincrement()) @id
+  allowUnknown Boolean            @default(true)
+  actions      ValidationAction[]
+  formId       String
+  form         Form               @relation(fields: [formId], references: [id])
 }
```



datasource db {
  provider = "postgresql"
  url = "***"
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

model User {
  id       String @default(uuid()) @id
  email    String @unique
  password String
  forms    Form[]
}

model Ip {
  address     String       @id
  submissions Submission[]
}

model Submission {
  id        Int      @default(autoincrement()) @id
  data      String
  formId    String
  form      Form     @relation(fields: [formId], references: [id])
  ipId      String
  ip        Ip       @relation(fields: [ipId], references: [address])
  spam      Boolean  @default(false)
  createdAt DateTime @default(now())
  note      String   @default("")
}

model Form {
  id            String         @id
  ownerId       String
  owner         User           @relation(fields: [ownerId], references: [id])
  name          String
  validation    Validation?
  notifications Notifications?
}

model Notifications {
  id              Int      @default(autoincrement()) @id
  emailRecipients String[]
  emailTitle      String   @default("")
  emailBody       String   @default("")
  webhooks        String[]
  formId          String
  form            Form     @relation(fields: [formId], references: [id])
}

model ValidationRule {
  id           Int        @default(autoincrement()) @id
  field        String
  validator    String
  detail       String?
  errorMessage String?
  validationId Int
  validation   Validation @relation(fields: [validationId], references: [id])
  createdAt    DateTime   @default(now())
}

model Validation {
  id           Int              @default(autoincrement()) @id
  allowUnknown Boolean          @default(true)
  rules        ValidationRule[]
  formId       String
  form         Form             @relation(fields: [formId], references: [id])
}